<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANNAMALAIYAR FINANCE рлР ЁУЙ╕ЁУЖШ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button.delete-btn {
            background: #e74c3c;
        }
        button:hover {
            opacity: 0.9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: top;
        }
        th {
            background-color: #3498db;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .total-summary {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .message {
            font-size: 14px;
            margin-top: 5px;
            padding: 5px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 800px;
            max-height: 80vh;
            overflow: auto;
            width: 90%;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .nowrap {
            white-space: nowrap;
        }
        .balance {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ANNAMALAIYAR FINANCE рлР ЁУЙ╕ЁУЖШ</h1>
        
        <div class="section">
            <h2>рокрпБродро┐роп ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роЪрпЗро░рпНроХрпНроХ</h2>
            <form id="customerForm">
                <div class="form-group">
                    <label for="customerName">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="phoneNumber">родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН</label>
                    <input type="text" id="phoneNumber" pattern="[0-9]{10}" title="10 digit phone number">
                </div>
                <div class="form-group">
                    <label for="aadharNumber">роЖродро╛ро░рпН роОрогрпН</label>
                    <input type="text" id="aadharNumber" pattern="[0-9]{12}" title="12 digit Aadhar number">
                </div>
                <div class="form-group">
                    <label for="principalAmount">роЕроЪро▓рпН родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="principalAmount" required min="1">
                </div>
                <div class="form-group">
                    <label for="startDate">родрпКроЯроХрпНроХ родрпЗродро┐</label>
                    <input type="date" id="startDate" required>
                </div>
                <button type="submit">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роЪрпЗро░рпНроХрпНроХ</button>
                <div id="formMessage" class="message" style="display:none;"></div>
            </form>
        </div>
        
        <div class="section">
            <h2>ро╡роЯрпНроЯро┐ рокрогроорпН рокрпЖро▒рпБродро▓рпН</h2>
            <form id="paymentForm">
                <div class="form-group">
                    <label for="customerSelect">ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН</label>
                    <select id="customerSelect" required>
                        <option value="">-- ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentDate">рокрогроорпН рокрпЖро▒рпБроорпН родрпЗродро┐</label>
                    <input type="date" id="paymentDate" required>
                </div>
                <div class="form-group">
                    <label for="dueAmount">ро╡роЯрпНроЯро┐ родрпКроХрпИ (тВ╣) (3%)</label>
                    <input type="number" id="dueAmount" readonly>
                </div>
                <div class="form-group">
                    <label for="paidAmount">рокрпЖро▒рокрпНрокроЯрпНроЯ родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="paidAmount" required min="1">
                </div>
                <div class="form-group">
                    <label for="balanceAmount">роорпАродро┐ родрпКроХрпИ (тВ╣)</label>
                    <input type="number" id="balanceAmount" readonly>
                </div>
                <div class="form-group">
                    <label for="paymentNotes">роХрпБро▒ро┐рокрпНрокрпБроХро│рпН</label>
                    <input type="text" id="paymentNotes">
                </div>
                <button type="submit">рокрогродрпНродрпИ рокродро┐ро╡рпБ роЪрпЖропрпНроХ</button>
                <div id="paymentMessage" class="message" style="display:none;"></div>
            </form>
        </div>
        
        <div class="section">
            <h2>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокродро┐ро╡рпБроХро│рпН</h2>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН, родрпКро▓рпИрокрпЗроЪро┐ роЕро▓рпНро▓родрпБ роЖродро╛ро░рпН роОрогрпН роорпВро▓роорпН родрпЗроЯрпБ..." style="width: 300px; padding: 10px;">
                <button onclick="searchCustomers()">родрпЗроЯрпБ</button>
                <button onclick="resetSearch()">роорпАроЯрпНроЯроорпИ</button>
            </div>
            
            <div style="overflow-x: auto;">
                <table id="customerTable">
                    <thead>
                        <tr>
                            <th>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН рокрпЖропро░рпН</th>
                            <th>родрпКро▓рпИрокрпЗроЪро┐</th>
                            <th>роЖродро╛ро░рпН роОрогрпН</th>
                            <th>роЕроЪро▓рпН</th>
                            <th>ро╡роЯрпНроЯро┐ ро╡ро┐роХро┐родроорпН</th>
                            <th>родрпКроЯроХрпНроХроорпН</th>
                            <th>роорпКродрпНродроорпН роЪрпЖро▓рпБродрпНродро┐ропродрпБ</th>
                            <th>роорпАродро┐ родрпКроХрпИ</th>
                            <th>роХроЯрпИроЪро┐ рокрогроорпН</th>
                            <th>роЪрпЖропро▓рпНроХро│рпН</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="total-summary">
                <h3>ро╡рогро┐роХ роЪрпБро░рпБроХрпНроХроорпН</h3>
                <p>роорпКродрпНрод ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпНроХро│рпН: <span id="totalCustomers">0</span></p>
                <p>роорпКродрпНрод роЕроЪро▓рпН родрпКроХрпИ: тВ╣<span id="totalPrincipal">0</span></p>
                <p>роорпКродрпНрод ро╡роЯрпНроЯро┐ родрпКроХрпИ: тВ╣<span id="totalInterest">0</span></p>
                <p>роорпКродрпНрод роорпАродро┐ родрпКроХрпИ: тВ╣<span id="totalBalance">0</span></p>
            </div>
        </div>
        
        <div id="paymentHistoryModal" class="modal">
            <div class="modal-content">
                <h2 id="modalCustomerName">рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп ро╡ро┐ро╡ро░роорпН</h2>
                <table id="paymentHistoryTable" style="width:100%;">
                    <thead>
                        <tr>
                            <th>родрпЗродро┐</th>
                            <th>ро╡роЯрпНроЯро┐ родрпКроХрпИ</th>
                            <th>рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ</th>
                            <th>роорпАродро┐</th>
                            <th>роХрпБро▒ро┐рокрпНрокрпБроХро│рпН</th>
                        </tr>
                    </thead>
                    <tbody id="paymentHistoryBody">
                    </tbody>
                </table>
                <button onclick="closeModal()" style="margin-top: 20px;">CLOSE</button>
            </div>
        </div>
        
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <h2>ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роирпАроХрпНроХрпБроХро┐ро▒рпАро░рпНроХро│ро╛?</h2>
                <p id="deleteCustomerText">роЗроирпНрод ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роиро┐ро░роирпНродро░рооро╛роХ роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?</p>
                <div style="margin-top: 20px;">
                    <button onclick="confirmDelete()" class="delete-btn">роЖроорпН, роирпАроХрпНроХрпБ</button>
                    <button onclick="cancelDelete()">роЗро▓рпНро▓рпИ, ро░родрпНродрпБроЪрпЖропрпН</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let customers = JSON.parse(localStorage.getItem('interestBusinessCustomers')) || [];
        let payments = JSON.parse(localStorage.getItem('interestBusinessPayments')) || [];
        let customerToDelete = null;
        
        const customerForm = document.getElementById('customerForm');
        const paymentForm = document.getElementById('paymentForm');
        const customerSelect = document.getElementById('customerSelect');
        const customerTableBody = document.getElementById('customerTableBody');
        const dueAmountInput = document.getElementById('dueAmount');
        const paidAmountInput = document.getElementById('paidAmount');
        const balanceAmountInput = document.getElementById('balanceAmount');
        
        document.addEventListener('DOMContentLoaded', function() {
            renderCustomerSelect();
            renderCustomerTable();
            updateSummary();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('paymentDate').value = today;
            
            customerSelect.addEventListener('change', function() {
                const customerId = this.value;
                if (customerId) {
                    const customer = customers.find(c => c.id === customerId);
                    if (customer) {
                        const interestAmount = customer.principal * 0.03;
                        dueAmountInput.value = interestAmount.toFixed(2);
                        paidAmountInput.value = '';
                        balanceAmountInput.value = interestAmount.toFixed(2);
                    }
                }
            });
            
            paidAmountInput.addEventListener('input', function() {
                const dueAmount = parseFloat(dueAmountInput.value) || 0;
                const paidAmount = parseFloat(this.value) || 0;
                const balance = dueAmount - paidAmount;
                balanceAmountInput.value = balance.toFixed(2);
            });
        });
        
        customerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customer = {
                id: Date.now().toString(),
                name: document.getElementById('customerName').value,
                phone: document.getElementById('phoneNumber').value,
                aadhar: document.getElementById('aadharNumber').value,
                principal: parseFloat(document.getElementById('principalAmount').value),
                rate: 3, 
                startDate: document.getElementById('startDate').value
            };
            
            customers.push(customer);
            saveData();
            
            customerForm.reset();
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            
            showMessage('formMessage', 'ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯро╛ро░рпН!', 'success');
            
            renderCustomerSelect();
            renderCustomerTable();
            updateSummary();
        });
        
        paymentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customerId = customerSelect.value;
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;
            
            const payment = {
                id: Date.now().toString(),
                customerId: customerId,
                date: document.getElementById('paymentDate').value,
                dueAmount: parseFloat(dueAmountInput.value),
                paidAmount: parseFloat(paidAmountInput.value),
                balance: parseFloat(balanceAmountInput.value),
                notes: document.getElementById('paymentNotes').value
            };
            
            payments.push(payment);
            saveData();
            
            if (customer.phone && customer.phone.length === 10) {
                sendSMSNotification(customer.phone, customer.name, payment.paidAmount, payment.balance);
            }
            
            paymentForm.reset();
            document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
            dueAmountInput.value = '';
            paidAmountInput.value = '';
            balanceAmountInput.value = '';
            
            showMessage('paymentMessage', 'ро╡роЯрпНроЯро┐ рокрогроорпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ! SMS роЕройрпБрокрпНрокрокрпНрокроЯрпНроЯродрпБ!', 'success');
            
            renderCustomerTable();
            updateSummary();
        });
        
        function sendSMSNotification(phoneNumber, customerName, paidAmount, balance) {
          
            
            const message = `ANNAMALAIYAR FINANCE: ро╡рогроХрпНроХроорпН ${customerName}, роЙроЩрпНроХро│рпН тВ╣${paidAmount.toFixed(2)} ро╡роЯрпНроЯро┐родрпН родрпКроХрпИ рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ. роорпАродро┐: тВ╣${balance.toFixed(2)}. роиройрпНро▒ро┐!`;
            
            console.log(`SMS sent to ${phoneNumber}: ${message}`);
            
          
        }
        
        function renderCustomerSelect() {
            customerSelect.innerHTML = '<option value="">-- ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --</option>';
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} (тВ╣${customer.principal.toFixed(2)})`;
                customerSelect.appendChild(option);
            });
        }
        
        function renderCustomerTable(filteredCustomers = null) {
            const displayCustomers = filteredCustomers || customers;
            customerTableBody.innerHTML = '';
            
            displayCustomers.forEach(customer => {
                const customerPayments = payments.filter(p => p.customerId === customer.id);
                const totalPaid = customerPayments.reduce((sum, p) => sum + p.paidAmount, 0);
                const totalBalance = customerPayments.reduce((sum, p) => sum + p.balance, 0);
                const lastPayment = customerPayments.length > 0 
                    ? new Date(customerPayments[customerPayments.length - 1].date).toLocaleDateString()
                    : 'роЗро▓рпНро▓рпИ';
                
                const formattedAadhar = customer.aadhar 
                    ? `${customer.aadhar.substring(0, 4)}-${customer.aadhar.substring(4, 8)}-${customer.aadhar.substring(8, 12)}` 
                    : '-';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="nowrap">${customer.name}</td>
                    <td class="nowrap">${customer.phone || '-'}</td>
                    <td class="nowrap">${formattedAadhar}</td>
                    <td class="nowrap">тВ╣${customer.principal.toFixed(2)}</td>
                    <td>${customer.rate}%</td>
                    <td class="nowrap">${new Date(customer.startDate).toLocaleDateString()}</td>
                    <td class="nowrap">тВ╣${totalPaid.toFixed(2)}</td>
                    <td class="nowrap balance">тВ╣${totalBalance.toFixed(2)}</td>
                    <td class="nowrap">${lastPayment}</td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="viewPaymentHistory('${customer.id}', '${customer.name}')">рокрогроорпН рокро╛ро░рпНроХрпНроХ</button>
                            <button onclick="showDeleteModal('${customer.id}', '${customer.name}')" class="delete-btn">роирпАроХрпНроХрпБ</button>
                        </div>
                    </td>
                `;
                customerTableBody.appendChild(row);
            });
        }
        
        function updateSummary() {
            document.getElementById('totalCustomers').textContent = customers.length;
            
            const totalPrincipal = customers.reduce((sum, c) => sum + c.principal, 0);
            document.getElementById('totalPrincipal').textContent = totalPrincipal.toFixed(2);
            
            const totalInterest = payments.reduce((sum, p) => sum + p.paidAmount, 0);
            document.getElementById('totalInterest').textContent = totalInterest.toFixed(2);
            
            const totalBalance = payments.reduce((sum, p) => sum + p.balance, 0);
            document.getElementById('totalBalance').textContent = totalBalance.toFixed(2);
        }
        
        function viewPaymentHistory(customerId, customerName) {
            const modal = document.getElementById('paymentHistoryModal');
            const customerPayments = payments.filter(p => p.customerId === customerId)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('modalCustomerName').textContent = `${customerName} - рокрогроорпН роЪрпЖро▓рпБродрпНродро┐роп ро╡ро┐ро╡ро░роорпН`;
            
            const paymentHistoryBody = document.getElementById('paymentHistoryBody');
            paymentHistoryBody.innerHTML = '';
            
            if (customerPayments.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" style="text-align:center;">рокрогроорпН роЪрпЖро▓рпБродрпНродро┐ропродрпБ роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ</td>';
                paymentHistoryBody.appendChild(row);
            } else {
                customerPayments.forEach(payment => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="nowrap">${new Date(payment.date).toLocaleDateString()}</td>
                        <td class="nowrap">тВ╣${payment.dueAmount.toFixed(2)}</td>
                        <td class="nowrap">тВ╣${payment.paidAmount.toFixed(2)}</td>
                        <td class="nowrap balance">тВ╣${payment.balance.toFixed(2)}</td>
                        <td>${payment.notes || '-'}</td>
                    `;
                    paymentHistoryBody.appendChild(row);
                });
            }
            
            modal.style.display = 'flex';
        }
        
        function showDeleteModal(customerId, customerName) {
            customerToDelete = customerId;
            document.getElementById('deleteCustomerText').textContent = 
                `роирпАроЩрпНроХро│рпН "${customerName}" ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпИ роиро┐ро░роирпНродро░рооро╛роХ роирпАроХрпНроХ ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│ро╛?`;
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function confirmDelete() {
            if (customerToDelete) {
                customers = customers.filter(c => c.id !== customerToDelete);
                payments = payments.filter(p => p.customerId !== customerToDelete);
                saveData();
                
                renderCustomerSelect();
                renderCustomerTable();
                updateSummary();
                
                showMessage('formMessage', 'ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роирпАроХрпНроХрокрпНрокроЯрпНроЯро╛ро░рпН!', 'success');
            }
            closeModal();
            customerToDelete = null;
        }
        
        function cancelDelete() {
            closeModal();
            customerToDelete = null;
        }
        
        function closeModal() {
            document.getElementById('paymentHistoryModal').style.display = 'none';
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        function searchCustomers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) return;
            
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) || 
                (c.phone && c.phone.includes(searchTerm)) ||
                (c.aadhar && c.aadhar.includes(searchTerm)));
            
            renderCustomerTable(filtered);
        }
        
        function resetSearch() {
            document.getElementById('searchInput').value = '';
            renderCustomerTable();
        }
        
        function showMessage(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = 'message ' + type;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 3000);
        }
        
        function saveData() {
            localStorage.setItem('interestBusinessCustomers', JSON.stringify(customers));
            localStorage.setItem('interestBusinessPayments', JSON.stringify(payments));
        }
    </script>
</body>
</html>